<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —î–º–Ω–æ—Å—Ç—ñ –∞–∫—É–º—É–ª—è—Ç–æ—Ä–∞</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 1em; background: #f0f0f0; }
    .container { max-width: 500px; margin: auto; background: white; padding: 1em; border-radius: 10px; }
    input, button, select { width: 100%; margin: 0.5em 0; padding: 0.5em; font-size: 1em; }
    .device-group { display: flex; gap: 0.5em; }
    .device-group input { flex: 1; }
    .result { margin-top: 1em; padding: 1em; background: #e0ffe0; border-radius: 5px; }
    .error { color: red; }
  </style>
</head>
<body>
  <div class="container">
    <h2>üîã –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —î–º–Ω–æ—Å—Ç—ñ –∞–∫—É–º—É–ª—è—Ç–æ—Ä–∞</h2>
    
    <!-- –ì–æ–¥–∏–Ω–∏ —Ä–æ–±–æ—Ç–∏ -->
    <label>–ß–∞—Å —Ä–æ–±–æ—Ç–∏ (–≥–æ–¥–∏–Ω–∏):</label>
    <input type="number" id="hours" placeholder="24" min="0.1" step="0.1">

    <!-- –ü–æ–ª—è –¥–ª—è –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ -->
    <div id="devices">
      <div class="device-group">
        <input type="number" placeholder="–ö—ñ–ª—å–∫—ñ—Å—Ç—å" min="1" step="1">
        <input type="number" placeholder="–°–ø–æ–∂–∏–≤–∞–Ω–Ω—è (–í—Ç)" min="0.1" step="0.1">
      </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ -->
    <button onclick="addDevice()">+ –î–æ–¥–∞—Ç–∏ –ø—Ä–∏—Å—Ç—Ä—ñ–π</button>
    <button onclick="calculate()">–†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏</button>

    <!-- –í–∏–≤—ñ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É -->
    <div id="output" class="result" style="display:none;"></div>
    <div id="error" class="error" style="display:none;"></div>
  </div>

  <script>
    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Telegram WebApp
    Telegram.WebApp.ready();
    Telegram.WebApp.expand();

    // –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é
    function addDevice() {
      const div = document.createElement('div');
      div.className = 'device-group';
      div.innerHTML = `
        <input type="number" placeholder="–ö—ñ–ª—å–∫—ñ—Å—Ç—å" min="1" step="1">
        <input type="number" placeholder="–°–ø–æ–∂–∏–≤–∞–Ω–Ω—è (–í—Ç)" min="0.1" step="0.1">
      `;
      document.getElementById('devices').appendChild(div);
    }

    // –û–±—Ä–æ–±–∫–∞ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É
    function calculate() {
      try {
        const hours = parseFloat(document.getElementById('hours').value);
        const devices = Array.from(document.querySelectorAll('.device-group'));
        let totalPower = 0;
        const devicesInfo = [];

        if (hours <= 0) throw new Error("–ß–∞—Å —Ä–æ–±–æ—Ç–∏ –º–∞—î –±—É—Ç–∏ –±—ñ–ª—å—à–µ 0");

        devices.forEach((group, index) => {
          const [qtyInput, powerInput] = group.querySelectorAll('input');
          const qty = parseFloat(qtyInput.value);
          const power = parseFloat(powerInput.value);

          if (isNaN(qty) || isNaN(power) || qty <= 0 || power <= 0) {
            throw new Error(`–ù–µ–≤—ñ—Ä–Ω—ñ –¥–∞–Ω—ñ –¥–ª—è –ø—Ä–∏—Å—Ç—Ä–æ—é #${index + 1}`);
          }

          totalPower += qty * power;
          devicesInfo.push(`${qty} √ó ${power} –í—Ç`);
        });

        if (devices.length === 0) throw new Error("–î–æ–¥–∞–π—Ç–µ —Ö–æ—á–∞ –± –æ–¥–∏–Ω –ø—Ä–∏—Å—Ç—Ä—ñ–π");

        // –†–æ–∑—Ä–∞—Ö—É–Ω–∫–∏
        const totalWh = totalPower * hours;
        const ah12v = totalWh / 12;
        const mah37v = (totalWh / 3.7) * 1000;

        // –í–∏–≤—ñ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
        document.getElementById('output').innerHTML = `
          <strong>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç:</strong><br>
          ‚Ä¢ –ß–∞—Å —Ä–æ–±–æ—Ç–∏: ${hours} –≥–æ–¥<br>
          ‚Ä¢ –ó–∞–≥–∞–ª—å–Ω–µ —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è: ${totalPower.toFixed(2)} –í—Ç<br>
          ‚Ä¢ –ó–∞–≥–∞–ª—å–Ω–∞ –ø–æ—Ç—Ä–µ–±–∞ –≤ –µ–Ω–µ—Ä–≥—ñ—ó: ${totalWh.toFixed(2)} –í—Ç¬∑–≥–æ–¥<br><br>
          <strong>üî¢ –Ñ–º–Ω—ñ—Å—Ç—å –∞–∫—É–º—É–ª—è—Ç–æ—Ä–∞:</strong><br>
          - –î–ª—è 12V —Å–∏—Å—Ç–µ–º–∏: ${ah12v.toFixed(2)} –ê¬∑–≥–æ–¥<br>
          - –î–ª—è 3.7V —Å–∏—Å—Ç–µ–º–∏: ${mah37v.toFixed(0)} –º–ê¬∑–≥–æ–¥
        `;
        document.getElementById('output').style.display = 'block';
        document.getElementById('error').style.display = 'none';

      } catch (e) {
        document.getElementById('error').textContent = "‚ùå –ü–æ–º–∏–ª–∫–∞: " + e.message;
        document.getElementById('error').style.display = 'block';
        document.getElementById('output').style.display = 'none';
      }
    }
  </script>
</body>
</html>