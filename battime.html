<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —á–∞—Å—É —Ä–æ–±–æ—Ç–∏ –≤—ñ–¥ –ê–ö–ë</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 1em; background: #f0f0f0; }
    .container { max-width: 500px; margin: auto; background: white; padding: 1em; border-radius: 10px; }
    input, button, select { width: 100%; margin: 0.5em 0; padding: 0.5em; font-size: 1em; }
    .device-group { display: flex; gap: 0.5em; }
    .device-group input { flex: 1; }
    .result { margin-top: 1em; padding: 1em; background: #e0ffe0; border-radius: 5px; }
    .error { color: red; }
  </style>
</head>
<body>
  <div class="container">
    <h2>üîã –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —á–∞—Å—É —Ä–æ–±–æ—Ç–∏ –≤—ñ–¥ –ê–ö–ë</h2>
    
    <!-- –Ñ–º–Ω—ñ—Å—Ç—å -->
    <label>–Ñ–º–Ω—ñ—Å—Ç—å:</label>
    <input type="number" id="capacity" placeholder="20000" min="0.1" step="any">

    <!-- –ù–∞–ø—Ä—É–≥–∞ -->
    <label>–ù–∞–ø—Ä—É–≥–∞ (–í):</label>
    <input type="number" id="voltage" placeholder="3.7" min="0.1" step="any">

    <!-- –ü–æ–ª—è –¥–ª—è –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ -->
    <div id="devices">
      <div class="device-group">
        <input type="number" placeholder="–ö—ñ–ª—å–∫—ñ—Å—Ç—å" min="1" step="1">
        <input type="number" placeholder="–°–ø–æ–∂–∏–≤–∞–Ω–Ω—è (–í—Ç)" min="0.1" step="0.1">
      </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ -->
    <button onclick="addDevice()">+ –î–æ–¥–∞—Ç–∏ –ø—Ä–∏—Å—Ç—Ä—ñ–π</button>
    <button onclick="calculate()">–†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏</button>

    <!-- –í–∏–≤—ñ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É -->
    <div id="output" class="result" style="display:none;"></div>
    <div id="error" class="error" style="display:none;"></div>
  </div>

  <script>
    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Telegram WebApp
    Telegram.WebApp.ready();
    Telegram.WebApp.expand();

    // –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é
    function addDevice() {
      const div = document.createElement('div');
      div.className = 'device-group';
      div.innerHTML = `
        <input type="number" placeholder="–ö—ñ–ª—å–∫—ñ—Å—Ç—å" min="1" step="1">
        <input type="number" placeholder="–°–ø–æ–∂–∏–≤–∞–Ω–Ω—è (–í—Ç)" min="0.1" step="0.1">
      `;
      document.getElementById('devices').appendChild(div);
    }

    // –û–±—Ä–æ–±–∫–∞ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É
    function calculate() {
      try {
        const capacity = parseFloat(document.getElementById('capacity').value);
        const voltage = parseFloat(document.getElementById('voltage').value);
        const devices = Array.from(document.querySelectorAll('.device-group'));
        let totalPower = 0;
        const devicesInfo = [];

        if (isNaN(capacity) || isNaN(voltage)) {
          throw new Error("–Ñ–º–Ω—ñ—Å—Ç—å —Ç–∞ –Ω–∞–ø—Ä—É–≥–∞ –º–∞—é—Ç—å –±—É—Ç–∏ —á–∏—Å–ª–∞–º–∏");
        }

        if (capacity <= 0 || voltage <= 0) {
          throw new Error("–Ñ–º–Ω—ñ—Å—Ç—å —Ç–∞ –Ω–∞–ø—Ä—É–≥–∞ –º–∞—é—Ç—å –±—É—Ç–∏ –±—ñ–ª—å—à–µ 0");
        }

        devices.forEach((group, index) => {
          const [qtyInput, powerInput] = group.querySelectorAll('input');
          const qty = parseFloat(qtyInput.value);
          const power = parseFloat(powerInput.value);

          if (isNaN(qty) || isNaN(power) || qty <= 0 || power <= 0) {
            throw new Error(`–ù–µ–≤—ñ—Ä–Ω—ñ –¥–∞–Ω—ñ –¥–ª—è –ø—Ä–∏—Å—Ç—Ä–æ—é #${index + 1}`);
          }

          totalPower += qty * power;
          devicesInfo.push(`${qty}√ó${power}W`);
        });

        if (totalPower === 0) {
          throw new Error("–°—É–º–∞—Ä–Ω–µ —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ 0");
        }

        // –†–æ–∑—Ä–∞—Ö—É–Ω–∫–∏
        const isLithium = voltage < 4; // Li-Ion (3.7V)
        const energyWh = isLithium 
          ? (capacity * voltage / 1000)  // mAh ‚Üí Wh –¥–ª—è Li-Ion
          : (capacity * voltage);        // Ah ‚Üí Wh –¥–ª—è 12V
        
        const hours = energyWh / totalPower;
        const hh = Math.floor(hours);
        const mm = Math.floor((hours % 1) * 60);

        // –í–∏–≤—ñ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
        document.getElementById('output').innerHTML = `
          <strong>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç:</strong><br>
          ‚Ä¢ –Ñ–º–Ω—ñ—Å—Ç—å: ${capacity}${isLithium ? "mAh" : "Ah"} ${voltage}V<br>
          ‚Ä¢ –ü—Ä–∏—Å—Ç—Ä–æ—ó: ${devicesInfo.join(" + ")}<br>
          ‚Ä¢ –°–ø–æ–∂–∏–≤–∞–Ω–Ω—è: ${totalPower.toFixed(2)} –í—Ç<br>
          ‚Ä¢ –î–æ—Å—Ç—É–ø–Ω–∞ –µ–Ω–µ—Ä–≥—ñ—è: ${energyWh.toFixed(2)} –í—Ç¬∑–≥–æ–¥<br><br>
          <strong>‚è≥ –¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å —Ä–æ–±–æ—Ç–∏:</strong><br>
          - ${hh} –≥–æ–¥ ${mm} —Ö–≤<br><br>
          <small>–ü—Ä–∏–º—ñ—Ç–∫–∞: –†–µ–∞–ª—å–Ω–∏–π —á–∞—Å –º–æ–∂–µ –±—É—Ç–∏ –º–µ–Ω—à–∏–º —á–µ—Ä–µ–∑ –≤—Ç—Ä–∞—Ç–∏ —Ç–∞ —Å–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è –ê–ö–ë</small>
        `;
        document.getElementById('output').style.display = 'block';
        document.getElementById('error').style.display = 'none';

      } catch (e) {
        document.getElementById('error').textContent = "‚ùå –ü–æ–º–∏–ª–∫–∞: " + e.message;
        document.getElementById('error').style.display = 'block';
        document.getElementById('output').style.display = 'none';
      }
    }
  </script>
</body>
</html>