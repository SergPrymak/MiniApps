<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>UPS - Калькулятор безперебійного живлення</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">
    <!-- Link to common styles -->
    <link rel="stylesheet" href="miniapps-common.css">
    <style>
        /* Styles specific to UPS calculator */
        .input-group {
            margin-bottom: 15px;
        }
        
        .material-buttons {
            display: flex;
            gap: 8px;
            margin-top: 5px;
        }

        .material-btn {
            flex: 1;
            background: #E8F5E9;
            color: #43A047;
            border: 1px solid #66BB6A;
            border-radius: 8px;
            padding: 8px 0;
            cursor: pointer;
        }

        .material-btn.active {
            background: #43A047;
            color: white;
        }

        .note-text {
            font-size: 0.9em;
            color: #666;
            margin-top: 10px;
        }

        .tab-buttons {
            display: flex;
            margin-bottom: 20px;
            gap: 8px;
        }
        .tab-button {
            flex: 1;
            background: #66BB6A; /* Зелений фон відповідно до категорії живлення */
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 0;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
        }
        .tab-button:active, .tab-button.active {
            background: #43A047; /* Темніший зелений для активного стану */
        }
        .device-row {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }
        .device-input {
            border: 1px solid #C2CFE0;
            border-radius: 8px;
            padding: 10px;
            font-size: 16px;
        }
        .add-device-btn {
            display: block;
            width: 100%;
            background: #E8F5E9; /* Світло-зелений фон як у .power-item */
            color: #43A047; /* Зелений колір як у .power-item .menu-icon */
            border: 1px solid #66BB6A;
            border-radius: 8px;
            padding: 10px 0;
            font-size: 15px;
            margin-top: 5px;
            margin-bottom: 20px;
            cursor: pointer;
        }
        .add-device-btn:hover {
            background: #C8E6C9; /* Як у .power-item:hover */
        }
        .remove-btn {
            background: none;
            border: none;
            color: #E6704B; /* Як у SolarWizard */
            font-size: 22px;
            padding: 0;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        .remove-btn:hover {
            color: #D85A3A;
        }
        /* Specific styles for voltage buttons */
        #v12Btn, #v37Btn {
             padding: 8px 0;
        }
        /* Стилі для результатів */
        .result-box {
            background-color: #FAFCFF;
            border: 1px solid #C2CFE0;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        /* Загальні іконки */
        .bi {
            color: #43A047; /* Зелений відповідно до категорії */
            margin-right: 6px;
        }
        /* Кнопка розрахунку */
        .calc-button {
            background-color: #43A047; /* Зелений відповідно до категорії */
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .calc-button:hover {
            background-color: #2E7D32;
        }
        /* Бейджик для типових пристроїв */
        .camera-badge {
            display: inline-block;
            background: #E8F5E9;
            color: #37474F;
            padding: 5px 8px;
            border-radius: 5px;
            font-size: 13px;
            margin: 2px 0;
            border: 1px solid #66BB6A;
        }
        .camera-badge .bi {
            color: #43A047;
            margin-right: 4px;
        }
        /* Заголовок та подзаголовок */
        .header-icon {
            color: #43A047;
        }
        /* Інформаційні іконки */
        .info-icon {
            color: #43A047;
        }
    </style>
</head>
<body>
    <a href="../index.html" class="back-link">← Повернутися до меню</a> <!-- Changed class to back-link -->
    <div class="header">
        <i class="bi bi-battery-charging header-icon"></i>
        <h1>Калькулятор UPS</h1>
        <p>Планування безперебійного живлення для систем відеоспостереження</p>
    </div>

    <div class="main-content">
        <div class="tab-buttons">
            <button class="tab-button" id="capacityTabBtn"><i class="bi bi-battery-full"></i> Розрахувати ємність АКБ</button>
            <button class="tab-button" id="timeTabBtn"><i class="bi bi-clock"></i> Розрахувати час автономії</button>
        </div>

        <!-- Cable Calculations Tabs -->
        <button class="tab-button" id="lossTabBtn"><i class="bi bi-lightning-charge"></i> Втрати в кабелі</button>
        <button class="tab-button" id="sectionTabBtn"><i class="bi bi-rulers"></i> Розрахунок перерізу</button>

        <!-- Power Loss Calculator Tab -->
        <div id="lossTab">
            <form id="lossCalcForm" autocomplete="off">
                <div class="input-group">
                    <label class="form-label"><i class="info-icon bi bi-lightning-charge"></i>Напруга (V):</label>
                    <input type="number" class="form-input" id="inputVoltage" min="12" step="1" value="24" required>
                </div>

                <div class="input-group">
                    <label class="form-label"><i class="info-icon bi bi-broadcast"></i>Потужність (W):</label>
                    <input type="number" class="form-input" id="inputPower" min="1" step="1" value="100" required>
                </div>

                <div class="input-group">
                    <label class="form-label"><i class="info-icon bi bi-code-square"></i>Тип струму:</label>
                    <div class="material-buttons">
                        <button type="button" class="material-btn active" data-value="dc">Постійний</button>
                        <button type="button" class="material-btn" data-value="ac">Змінний</button>
                    </div>
                    <input type="hidden" id="currentType" value="dc">
                </div>

                <div class="input-group">
                    <label class="form-label"><i class="info-icon bi bi-postage"></i>Матеріал:</label>
                    <div class="material-buttons">
                        <button type="button" class="material-btn active" data-value="cu">Мідь</button>
                        <button type="button" class="material-btn" data-value="al">Алюміній</button>
                    </div>
                    <input type="hidden" id="cableMaterial" value="cu">
                </div>

                <div class="input-group">
                    <label class="form-label"><i class="info-icon bi bi-arrows-move"></i>Відстань (м):</label>
                    <input type="number" class="form-input" id="cableLength" min="1" step="1" value="50" required>
                </div>

                <div class="input-group">
                    <label class="form-label"><i class="info-icon bi bi-circle"></i>Переріз (mm²):</label>
                    <input type="number" class="form-input" id="cableSection" min="0.5" step="0.5" value="1.5" required>
                </div>

                <button type="submit" class="calc-button"><i class="bi bi-calculator"></i> Розрахувати втрати</button>
            </form>

            <div id="lossResult" class="result-box" style="display:none;">
                <div id="lossResultContent"></div>
            </div>
        </div>

        <!-- Cable Section Calculator Tab -->
        <div id="sectionTab" style="display:none;">
            <form id="sectionCalcForm" autocomplete="off">
                <div class="input-group">
                    <label class="form-label"><i class="info-icon bi bi-lightning-charge"></i>Напруга (V):</label>
                    <input type="number" class="form-input" id="sectionVoltage" min="12" step="1" value="24" required>
                </div>

                <div class="input-group">
                    <label class="form-label"><i class="info-icon bi bi-broadcast"></i>Потужність (W):</label>
                    <input type="number" class="form-input" id="sectionPower" min="1" step="1" value="100" required>
                </div>

                <div class="input-group">
                    <label class="form-label"><i class="info-icon bi bi-arrows-move"></i>Відстань (м):</label>
                    <input type="number" class="form-input" id="sectionLength" min="1" step="1" value="50" required>
                </div>

                <div class="input-group">
                    <label class="form-label"><i class="info-icon bi bi-percent"></i>Макс. втрати (%):</label>
                    <input type="number" class="form-input" id="maxLoss" min="1" max="10" value="3" required>
                </div>

                <button type="submit" class="calc-button"><i class="bi bi-calculator"></i> Підібрати переріз</button>
            </form>

            <div id="sectionResult" class="result-box" style="display:none;">
                <div id="sectionResultContent"></div>
            </div>
        </div>


        <div class="tips-section">
            <p><i class="bi bi-info-circle"></i> <strong>Як використовувати калькулятор?</strong></p>
            <p>Основні параметри для розрахунків:</p>
            <ul>
                <li>Напруга живлення (12V/24V/48V)</li>
                <li>Потужність навантаження у ватах (Вт)</li>
                <li>Матеріал та довжина кабелю</li>
                <li>Допустимі втрати напруги</li>
            </ul>

            <p><i class="bi bi-gear"></i> <strong>Технічні деталі:</strong></p>
            <ul>
                <li>Опір міді: 0.0172 Ом·мм²/м</li>
                <li>Опір алюмінію: 0.0283 Ом·мм²/м</li>
                <li>Рекомендовані втрати: 3-5% від напруги</li>
            </ul>

            <p><i class="bi bi-lightbulb"></i> <strong>Приклади:</strong></p>
            <ul>
                <li>100W на 24V, 50м кабелю - мінімальний переріз 1.5 мм²</li>
                <li>200W на 12V, 20м кабелю - втрати напруги 0.8V</li>
            </ul>
        </div>
    </div>
    <!-- Підключення JS-файлів -->
    <script src="ups.js"></script>
    <script>
        // Cable Calculator Logic
        const materialResistivity = {
            'cu': 0.0172, // Ом*мм²/м
            'al': 0.0283  // Ом*мм²/м
        };

        // Loss Calculator
        document.getElementById('lossCalcForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const voltage = parseFloat(document.getElementById('inputVoltage').value);
            const power = parseFloat(document.getElementById('inputPower').value);
            const material = document.getElementById('cableMaterial').value;
            const length = parseFloat(document.getElementById('cableLength').value);
            const section = parseFloat(document.getElementById('cableSection').value);
            
            const current = power / voltage;
            const resistance = (2 * length * materialResistivity[material]) / section;
            const voltageDrop = current * resistance;
            const powerLoss = current * current * resistance;
            
            const resultHTML = `
                <p><i class="bi bi-lightning"></i> Втрата напруги: <strong>${voltageDrop.toFixed(2)} V</strong></p>
                <p><i class="bi bi-plug"></i> Втрата потужності: <strong>${powerLoss.toFixed(2)} W</strong></p>
                <p><i class="bi bi-percent"></i> Відсоток втрат: <strong>${((voltageDrop / voltage) * 100).toFixed(1)}%</strong></p>
            `;
            
            document.getElementById('lossResultContent').innerHTML = resultHTML;
            document.getElementById('lossResult').style.display = 'block';
        });

        // Section Calculator
        document.getElementById('sectionCalcForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const voltage = parseFloat(document.getElementById('sectionVoltage').value);
            const power = parseFloat(document.getElementById('sectionPower').value);
            const length = parseFloat(document.getElementById('sectionLength').value);
            const maxLoss = parseFloat(document.getElementById('maxLoss').value) / 100;
            
            const current = power / voltage;
            const maxVoltageDrop = voltage * maxLoss;
            
            const calculateSection = (material) => {
                return (2 * length * materialResistivity[material] * current) / maxVoltageDrop;
            };
            
            const cuSection = calculateSection('cu');
            const alSection = calculateSection('al');
            
            const resultHTML = `
                <h4><i class="bi bi-lightning-charge"></i> Необхідний переріз:</h4>
                <p><span class="camera-badge"><i class="bi bi-cpu"></i> Мідь:</span> ${Math.ceil(cuSection)} мм²</p>
                <p><span class="camera-badge"><i class="bi bi-cpu"></i> Алюміній:</span> ${Math.ceil(alSection)} мм²</p>
                <p class="note-text">* Рекомендовано використовувати найближчий стандартний переріз</p>
            `;
            
            document.getElementById('sectionResultContent').innerHTML = resultHTML;
            document.getElementById('sectionResult').style.display = 'block';
        });

        // Tab Switching
        document.getElementById('lossTabBtn').addEventListener('click', () => {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById('lossTabBtn').classList.add('active');
            document.getElementById('sectionTab').style.display = 'none';
            document.getElementById('lossTab').style.display = 'block';
        });

        document.getElementById('sectionTabBtn').addEventListener('click', () => {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById('sectionTabBtn').classList.add('active');
            document.getElementById('lossTab').style.display = 'none';
            document.getElementById('sectionTab').style.display = 'block';
        });

        // Material/Type Selection
        document.querySelectorAll('.material-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                this.parentElement.querySelectorAll('.material-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                const fieldId = this.closest('.input-group').querySelector('input[type="hidden"]').id;
                document.getElementById(fieldId).value = this.dataset.value;
            });
        });
    </script>
</body>
</html>
