<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SolarGenWizard - –ü—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó —Å–æ–Ω—è—á–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">
    <link rel="stylesheet" href="miniapps-common.css">
    <link rel="stylesheet" href="solarwizard-styles.css">
</head>
<body>
    <a href="../index.html" class="back-button">‚Üê –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –º–µ–Ω—é</a>
    <div class="header">
        <i class="bi bi-sun header-icon"></i>
        <h1>SolarGenWizard</h1>
        <p>–ü—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó —Å–æ–Ω—è—á–Ω–æ—ó –µ–ª–µ–∫—Ç—Ä–æ—Å—Ç–∞–Ω—Ü—ñ—ó —Ç–∞ –µ–∫–æ–Ω–æ–º—ñ—á–Ω–æ—ó –≤–∏–≥–æ–¥–∏</p>
    </div>

    <div class="main-content">
        <form id="solarWizardForm" autocomplete="off">
            <label class="form-label"><i class="info-icon bi bi-geo-alt"></i>–†–µ–≥—ñ–æ–Ω:</label>
            <select class="form-input" id="regionSelect">
                <!-- –ë—É–¥–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–æ –¥–∏–Ω–∞–º—ñ—á–Ω–æ -->
            </select>
            
            <label class="form-label"><i class="info-icon bi bi-lightning-charge"></i>–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –ø–∞–Ω–µ–ª–µ–π(–∫–í—Ç):</label>
            <div class="power-input-container">
                <input type="number" class="form-input" id="powerInput" min="1" step="0.1" value="10" required>
                <div class="auto-power-checkbox">
                    <input type="checkbox" id="autoPowerCheckbox">
                    <label for="autoPowerCheckbox">–ê–≤—Ç–æ–ø—ñ–¥–±—ñ—Ä</label>
                </div>
            </div>
            <div id="powerAutoInfo" class="auto-power-info" style="display: none;"></div>
            
            <label class="form-label"><i class="info-icon bi bi-house-door"></i>–í–ª–∞—Å–Ω–µ —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è(–∫–í—Ç¬∑–≥–æ–¥/–º—ñ—Å, –Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ):</label>
            <input type="number" class="form-input" id="consumptionInput" min="0" step="1" value="300">
            
            <div class="advanced-params-header">
                <a href="#" id="toggleAdvancedParams"><i class="bi bi-gear"></i> –†–æ–∑—à–∏—Ä–µ–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏</a>
            </div>
            
            <div id="advancedParams" style="display: none;">
                <label class="form-label"><i class="info-icon bi bi-currency-euro"></i>–ó–µ–ª–µ–Ω–∏–π —Ç–∞—Ä–∏—Ñ (‚Ç¨/–∫–í—Ç¬∑–≥–æ–¥):</label>
                <input type="number" class="form-input" id="greenTariffInput" min="0.01" step="0.01" value="0.16">
                
                <label class="form-label"><i class="info-icon bi bi-percent"></i>–ü–æ–¥–∞—Ç–æ–∫ (%):</label>
                <input type="number" class="form-input" id="taxInput" min="0" max="100" step="1" value="23">
                
                <label class="form-label"><i class="info-icon bi bi-cash-coin"></i>–¶—ñ–Ω–∞ –¥–ª—è –¥–æ–º–æ–≥–æ—Å–ø–æ–¥–∞—Ä—Å—Ç–≤ (–≥—Ä–Ω/–∫–í—Ç¬∑–≥–æ–¥):</label>
                <input type="number" class="form-input" id="domesticPriceInput" min="0.01" step="0.01" value="4.32">
            </div>

            <button type="submit" class="calc-button"><i class="bi bi-calculator"></i> –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
        </form>
        
        <div id="resultBox" class="result-box" style="display:none;">
            <div id="resultContent"></div>
        </div>

        <div class="tips-section">
            <p><i class="bi bi-info-circle"></i> <strong>–ü—Ä–æ SolarGenWizard</strong></p>
            <p>SolarGenWizard –¥–æ–ø–æ–º–∞–≥–∞—î —Ä–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤–∞–Ω—É –≥–µ–Ω–µ—Ä–∞—Ü—ñ—é —Å–æ–Ω—è—á–Ω–æ—ó –µ–ª–µ–∫—Ç—Ä–æ—Å—Ç–∞–Ω—Ü—ñ—ó —Ç–∞ –æ—Ü—ñ–Ω–∏—Ç–∏ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤—ñ –ø–µ—Ä–µ–≤–∞–≥–∏.</p>
            
            <p><i class="bi bi-sun"></i> <strong>–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó</strong></p>
            <p>–ë–∞–∑—É—î—Ç—å—Å—è –Ω–∞:</p>
            <ul>
                <li>–ü–æ—Ç—É–∂–Ω–æ—Å—Ç—ñ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—Ö —Å–æ–Ω—è—á–Ω–∏—Ö –ø–∞–Ω–µ–ª–µ–π</li>
                <li>–ú—ñ—Å—è—á–Ω–∏—Ö –ø–æ–∫–∞–∑–Ω–∏–∫–∞—Ö —Å–æ–Ω—è—á–Ω–æ—ó —ñ–Ω—Å–æ–ª—è—Ü—ñ—ó –¥–ª—è –≤–∏–±—Ä–∞–Ω–æ–≥–æ —Ä–µ–≥—ñ–æ–Ω—É</li>
                <li>–ö—ñ–ª—å–∫–æ—Å—Ç—ñ –¥–Ω—ñ–≤ —É –∫–æ–∂–Ω–æ–º—É –º—ñ—Å—è—Ü—ñ</li>
            </ul>
            
            <p><i class="bi bi-cash-coin"></i> <strong>–ï–∫–æ–Ω–æ–º—ñ—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑</strong></p>
            <ul>
                <li>–ê–Ω–∞–ª—ñ–∑ –≤–ª–∞—Å–Ω–æ–≥–æ —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è —Ç–∞ –µ–∫–æ–Ω–æ–º—ñ—ó –∫–æ—à—Ç—ñ–≤ –∑–∞ —Ç–∞—Ä–∏—Ñ–∞–º–∏ –¥–ª—è –¥–æ–º–æ–≥–æ—Å–ø–æ–¥–∞—Ä—Å—Ç–≤</li>
                <li>–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –Ω–∞–¥–ª–∏—à–∫—É –µ–ª–µ–∫—Ç—Ä–æ–µ–Ω–µ—Ä–≥—ñ—ó, —â–æ –º–æ–∂–µ –±—É—Ç–∏ –ø—Ä–æ–¥–∞–Ω–∞ –∑–∞ "–∑–µ–ª–µ–Ω–∏–º" —Ç–∞—Ä–∏—Ñ–æ–º</li>
                <li>–û—Ü—ñ–Ω–∫–∞ —Ä—ñ—á–Ω–æ–≥–æ –ø—Ä–∏–±—É—Ç–∫—É –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –ø–æ–¥–∞—Ç–∫—ñ–≤</li>
            </ul>
            
            <p><i class="bi bi-lightbulb"></i> <strong>–¢–µ—Ö–Ω—ñ—á–Ω—ñ –ø—Ä–∏–º—ñ—Ç–∫–∏</strong></p>
            <ul>
                <li>–ö–ö–î —Å–∏—Å—Ç–µ–º–∏ –≤—Ä–∞—Ö–æ–≤–∞–Ω–æ —è–∫ 80% –≤—ñ–¥ —Ç–µ–æ—Ä–µ—Ç–∏—á–Ω–æ –º–æ–∂–ª–∏–≤–æ—ó –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó</li>
                <li>–ó–µ–ª–µ–Ω–∏–π —Ç–∞—Ä–∏—Ñ: 0,16 ‚Ç¨/–∫–í—Ç¬∑–≥–æ–¥ (–∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –ü–î–í)</li>
                <li>–¶—ñ–Ω–∞ –¥–ª—è –¥–æ–º–æ–≥–æ—Å–ø–æ–¥–∞—Ä—Å—Ç–≤: 2,64 –≥—Ä–Ω/–∫–í—Ç¬∑–≥–æ–¥</li>
                <li>–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ø–æ–º—ñ—Å—è—á–Ω–æ –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —Å–µ–∑–æ–Ω–Ω–æ—ó –∑–º—ñ–Ω–∏ —ñ–Ω—Å–æ–ª—è—Ü—ñ—ó</li>
            </ul>
        </div>
    </div>
    
    <script src="solarwizard.js"></script>
    <script>
    // –í–µ—Å—å –∫–æ–¥ –≤–∏–∫–æ–Ω—É—î–º–æ —Ç—ñ–ª—å–∫–∏ –ø—ñ—Å–ª—è –ø–æ–≤–Ω–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è DOM
    document.addEventListener('DOMContentLoaded', function() {
        console.log("DOM –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ, —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä...");
        
        // --- –ö–û–ù–°–¢–ê–ù–¢–ò –¢–ê –î–û–í–Ü–î–ö–û–í–Ü –î–ê–ù–Ü ---
        const INSOLATION_DATA = {
            vinn: [1.3,1.9,2.9,3.8,4.5,5.1,5.5,5.1,3.9,2.6,1.4,1.1],
            dnip: [1.6,2.3,3.5,4.6,5.3,5.9,6.2,5.7,4.2,2.7,1.6,1.3],
            done: [1.5,2.2,3.3,4.3,5.0,5.7,6.0,5.5,4.0,2.6,1.5,1.2],
            zhyto: [1.1,1.7,2.7,3.7,4.4,5.0,5.3,4.9,3.7,2.4,1.2,0.9],
            zapor: [1.7,2.4,3.6,4.7,5.4,6.0,6.3,5.8,4.3,2.8,1.7,1.4],
            ifra: [1.0,1.6,2.6,3.6,4.3,4.9,5.2,4.8,3.6,2.3,1.1,0.8],
            kyiv: [1.1,1.7,2.7,3.7,4.4,5.0,5.3,4.9,3.7,2.4,1.2,0.9],
            krop: [1.4,2.0,3.1,4.1,4.8,5.4,5.7,5.2,3.9,2.5,1.4,1.1],
            lutsk: [1.0,1.5,2.5,3.5,4.2,4.8,5.1,4.7,3.5,2.2,1.1,0.8],
            luhan: [1.5,2.2,3.3,4.3,5.0,5.7,6.0,5.5,4.0,2.6,1.5,1.2],
            lviv: [1.0,1.5,2.5,3.5,4.2,4.8,5.1,4.7,3.5,2.2,1.1,0.8],
            myko: [1.7,2.4,3.6,4.7,5.4,6.0,6.3,5.8,4.3,2.8,1.7,1.4],
            odes: [1.7,2.4,3.6,4.7,5.4,6.0,6.3,5.8,4.3,2.8,1.7,1.4],
            polt: [1.3,1.9,2.9,3.8,4.5,5.1,5.5,5.1,3.9,2.6,1.4,1.1],
            rivn: [1.0,1.5,2.5,3.5,4.2,4.8,5.1,4.7,3.5,2.2,1.1,0.8],
            sumy: [1.1,1.7,2.7,3.7,4.4,5.0,5.3,4.9,3.7,2.4,1.2,0.9],
            symf: [1.8,2.5,3.7,4.8,5.5,6.1,6.4,5.9,4.4,2.9,1.8,1.5],
            tern: [1.0,1.6,2.6,3.6,4.3,4.9,5.2,4.8,3.6,2.3,1.1,0.8],
            uzho: [1.0,1.5,2.5,3.5,4.2,4.8,5.1,4.7,3.5,2.2,1.1,0.8],
            khark: [1.2,1.8,2.8,3.8,4.5,5.1,5.4,5.0,3.8,2.5,1.3,1.0],
            kher: [1.8,2.5,3.7,4.8,5.5,6.1,6.4,5.9,4.4,2.9,1.8,1.5],
            kmel: [1.1,1.7,2.7,3.7,4.4,5.0,5.3,4.9,3.7,2.4,1.2,0.9],
            cher: [1.1,1.7,2.7,3.7,4.4,5.0,5.3,4.9,3.7,2.4,1.2,0.9],
            chrn: [1.1,1.7,2.7,3.7,4.4,5.0,5.3,4.9,3.7,2.4,1.2,0.9],
            chrv: [1.2,1.8,2.8,3.8,4.5,5.1,5.4,5.0,3.8,2.5,1.3,1.0]
        };
        const REGION_NAMES = {
            vinn: "–í—ñ–Ω–Ω–∏—Ü—è", dnip: "–î–Ω—ñ–ø—Ä–æ", done: "–î–æ–Ω–µ—Ü—å–∫", zhyto: "–ñ–∏—Ç–æ–º–∏—Ä", zapor: "–ó–∞–ø–æ—Ä—ñ–∂–∂—è",
            ifra: "–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫", kyiv: "–ö–∏—ó–≤", krop: "–ö—Ä–æ–ø–∏–≤–Ω–∏—Ü—å–∫–∏–π", lutsk: "–õ—É—Ü—å–∫", luhan: "–õ—É–≥–∞–Ω—Å—å–∫",
            lviv: "–õ—å–≤—ñ–≤", myko: "–ú–∏–∫–æ–ª–∞—ó–≤", odes: "–û–¥–µ—Å–∞", polt: "–ü–æ–ª—Ç–∞–≤–∞", rivn: "–†—ñ–≤–Ω–µ", sumy: "–°—É–º–∏",
            symf: "–°—ñ–º—Ñ–µ—Ä–æ–ø–æ–ª—å", tern: "–¢–µ—Ä–Ω–æ–ø—ñ–ª—å", uzho: "–£–∂–≥–æ—Ä–æ–¥", khark: "–•–∞—Ä–∫—ñ–≤", kher: "–•–µ—Ä—Å–æ–Ω",
            kmel: "–•–º–µ–ª—å–Ω–∏—Ü—å–∫–∏–π", cher: "–ß–µ—Ä–∫–∞—Å–∏", chrn: "–ß–µ—Ä–Ω—ñ–≥—ñ–≤", chrv: "–ß–µ—Ä–Ω—ñ–≤—Ü—ñ"
        };
        const MONTHS_UA = ["–°—ñ—á–µ–Ω—å","–õ—é—Ç–∏–π","–ë–µ—Ä–µ–∑–µ–Ω—å","–ö–≤—ñ—Ç–µ–Ω—å","–¢—Ä–∞–≤–µ–Ω—å","–ß–µ—Ä–≤–µ–Ω—å","–õ–∏–ø–µ–Ω—å","–°–µ—Ä–ø–µ–Ω—å","–í–µ—Ä–µ—Å–µ–Ω—å","–ñ–æ–≤—Ç–µ–Ω—å","–õ–∏—Å—Ç–æ–ø–∞–¥","–ì—Ä—É–¥–µ–Ω—å"];
        const DAYS_IN_MONTH = [31,28,31,30,31,30,31,31,30,31,30,31];
        const SYSTEM_EFFICIENCY = 0.8; // –ö–ö–î —Å–∏—Å—Ç–µ–º–∏
        const DOMESTIC_PRICE = 2.64; // –≥—Ä–Ω/–∫–í—Ç¬∑–≥–æ–¥
        const GREEN_TARIFF = 0.16; // ‚Ç¨/–∫–í—Ç¬∑–≥–æ–¥
        const PDV = 0.2; // 20% –ü–î–í
        
        // --- –û–¢–†–ò–ú–ê–ù–ù–Ø –ï–õ–ï–ú–ï–ù–¢–Ü–í –§–û–†–ú–ò ---
        const formElement = document.getElementById('solarWizardForm');
        const regionSelectElement = document.getElementById('regionSelect');
        const powerInputElement = document.getElementById('powerInput');
        const consumptionInputElement = document.getElementById('consumptionInput');
        const resultContentElement = document.getElementById('resultContent');
        const resultBoxElement = document.getElementById('resultBox');
        const autoPowerCheckboxElement = document.getElementById('autoPowerCheckbox');
        
        // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —Ä–æ–∑—à–∏—Ä–µ–Ω–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
        const greenTariffInputElement = document.getElementById('greenTariffInput');
        const taxInputElement = document.getElementById('taxInput');
        const domesticPriceInputElement = document.getElementById('domesticPriceInput');
        const toggleAdvancedParamsElement = document.getElementById('toggleAdvancedParams');
        const advancedParamsElement = document.getElementById('advancedParams');
        
        // --- –ü–ï–†–ï–í–Ü–†–ö–ê –ù–ê–Ø–í–ù–û–°–¢–Ü –ï–õ–ï–ú–ï–ù–¢–Ü–í ---
        if (!formElement || !regionSelectElement || !powerInputElement || !consumptionInputElement || !resultContentElement || !resultBoxElement) {
            console.error("–ü–æ–º–∏–ª–∫–∞: –Ω–µ –≤—Å—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –∑–Ω–∞–π–¥–µ–Ω—ñ");
            alert("–ö—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞: –Ω–µ –≤—Å—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ —Ñ–æ—Ä–º–∏ –∑–Ω–∞–π–¥–µ–Ω—ñ. –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Å—Ç–æ—Ä—ñ–Ω–∫—É.");
            return;
        }
        
        // --- –ó–ê–ü–û–í–ù–ï–ù–ù–Ø –°–ü–ò–°–ö–£ –†–ï–ì–Ü–û–ù–Ü–í ---
        regionSelectElement.innerHTML = Object.entries(REGION_NAMES)
            .map(([key, name]) => `<option value="${key}">${name}</option>`)
            .join('');
        console.log("–ó–∞–ø–æ–≤–Ω–µ–Ω–æ —Å–ø–∏—Å–æ–∫ —Ä–µ–≥—ñ–æ–Ω—ñ–≤");
        
        // --- –§–£–ù–ö–¶–Ü–á –†–û–ó–†–ê–•–£–ù–ö–£ ---
        function calculateGeneration(region, powerKW) {
            const monthlyInsolation = INSOLATION_DATA[region];
            let monthlyGeneration = [];
            
            for (let i = 0; i < 12; i++) {
                const generationForMonth = monthlyInsolation[i] * powerKW * DAYS_IN_MONTH[i] * SYSTEM_EFFICIENCY;
                monthlyGeneration.push(generationForMonth);
            }
            
            return monthlyGeneration;
        }
        
        function calculateConsumption(monthlyGeneration, monthlyConsumption) {
            let ownMonthly = []; // –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ –≤–ª–∞—Å–Ω–æ—ó –µ–Ω–µ—Ä–≥—ñ—ó
            let gridMonthly = []; // –í–∑—è—Ç–æ –∑ –º–µ—Ä–µ–∂—ñ
            let remainingMonthly = []; // –ó–∞–ª–∏—à–æ–∫ –¥–ª—è –ø—Ä–æ–¥–∞–∂—É
            let usedForOwnTotal = 0; // –ó–∞–≥–∞–ª–æ–º –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ –≤–ª–∞—Å–Ω–æ—ó
            let gridTotal = 0; // –ó–∞–≥–∞–ª–æ–º –≤–∑—è—Ç–æ –∑ –º–µ—Ä–µ–∂—ñ
            
            for (let i = 0; i < 12; i++) {
                const ownNeed = monthlyConsumption;
                const solarGeneration = monthlyGeneration[i];
                const usedFromSolar = Math.min(solarGeneration, ownNeed);
                const takenFromGrid = Math.max(0, ownNeed - solarGeneration);
                const remaining = Math.max(0, solarGeneration - usedFromSolar);
                
                ownMonthly.push(usedFromSolar);
                gridMonthly.push(takenFromGrid);
                remainingMonthly.push(remaining);
                usedForOwnTotal += usedFromSolar;
                gridTotal += takenFromGrid;
            }
            
            return {
                ownMonthly,
                gridMonthly,
                remainingMonthly,
                usedForOwnTotal,
                gridTotal
            };
        }
        
        // --- –§–£–ù–ö–¶–Ü–Ø –í–ò–í–ï–î–ï–ù–ù–Ø –†–ï–ó–£–õ–¨–¢–ê–¢–£ ---
        function displayResult(html) {
            resultContentElement.innerHTML = html;
            resultBoxElement.style.display = 'block';
            console.log("–†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∏–≤–µ–¥–µ–Ω–æ");
        }
        
        // --- –†–û–ë–û–¢–ê –ó –†–û–ó–®–ò–†–ï–ù–ò–ú–ò –ü–ê–†–ê–ú–ï–¢–†–ê–ú–ò ---
        toggleAdvancedParamsElement.addEventListener('click', function(e) {
            e.preventDefault();
            advancedParamsElement.style.display = advancedParamsElement.style.display === 'none' ? 'block' : 'none';
        });
        
        // --- –§–£–ù–ö–¶–Ü–Ø –ê–í–¢–û–ü–Ü–î–ë–û–†–£ –ü–û–¢–£–ñ–ù–û–°–¢–Ü ---
        function calculateOptimalPower(region, monthlyConsumption) {
            // –ù–∞–π–º–µ–Ω—à–∞ —ñ–Ω—Å–æ–ª—è—Ü—ñ—è –≤ —Ä–µ–≥—ñ–æ–Ω—ñ
            const minInsolation = Math.min(...INSOLATION_DATA[region]);
            const minInsolationMonth = INSOLATION_DATA[region].indexOf(minInsolation);
            
            // –ö—ñ–ª—å–∫—ñ—Å—Ç—å –¥–Ω—ñ–≤ —É –º—ñ—Å—è—Ü—ñ –∑ –Ω–∞–π–º–µ–Ω—à–æ—é —ñ–Ω—Å–æ–ª—è—Ü—ñ—î—é
            const daysInMinMonth = DAYS_IN_MONTH[minInsolationMonth];
            
            // –ó–Ω–∞–π—Ç–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω—É –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å —Å–æ–Ω—è—á–Ω–∏—Ö –ø–∞–Ω–µ–ª–µ–π –¥–ª—è –ø–æ–∫—Ä–∏—Ç—Ç—è —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è
            // –≤ –º—ñ—Å—è—Ü—å –∑ –Ω–∞–π–º–µ–Ω—à–æ—é —ñ–Ω—Å–æ–ª—è—Ü—ñ—î—é, –∑–∞ —Ñ–æ—Ä–º—É–ª–æ—é:
            // –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å = –º—ñ—Å—è—á–Ω–µ_—Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è / (—ñ–Ω—Å–æ–ª—è—Ü—ñ—è * –¥–Ω—ñ_–≤_–º—ñ—Å—è—Ü—ñ * –ö–ö–î)
            const optimalPower = monthlyConsumption / (minInsolation * daysInMinMonth * SYSTEM_EFFICIENCY);
            
            return {
                power: optimalPower,
                minInsolation: minInsolation,
                month: MONTHS_UA[minInsolationMonth]
            };
        }
        
        // --- –§–£–ù–ö–¶–Ü–Ø –û–ù–û–í–õ–ï–ù–ù–Ø –ü–û–¢–£–ñ–ù–û–°–¢–Ü –ü–†–ò –ê–í–¢–û–ü–Ü–î–ë–û–†–Ü ---
        function updatePowerWithAutoCalculation() {
            if (!autoPowerCheckboxElement.checked) {
                return;
            }
            
            const region = regionSelectElement.value;
            const consumption = parseFloat(consumptionInputElement.value.replace(',', '.')) || 0;
            
            if (!region || !(region in INSOLATION_DATA) || consumption <= 0) {
                return;
            }
            
            const optimalPowerData = calculateOptimalPower(region, consumption);
            const roundedPower = Math.ceil(optimalPowerData.power * 10) / 10; // –û–∫—Ä—É–≥–ª—é—î–º–æ –¥–æ 0.1 –∫–í—Ç
            
            powerInputElement.value = roundedPower.toFixed(1);
            
            // –î–æ–¥–∞—î–º–æ –ø–æ—è—Å–Ω–µ–Ω–Ω—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø—ñ–¥–∫–∞–∑–∫–∏
            const powerInfoElement = document.getElementById('powerAutoInfo');
            if (powerInfoElement) {
                powerInfoElement.innerHTML = `<i class="bi bi-info-circle"></i> –†–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω–æ –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è ${consumption} –∫–í—Ç¬∑–≥–æ–¥/–º—ñ—Å 
                    —É –º—ñ—Å—è—Ü—å –∑ –Ω–∞–π–º–µ–Ω—à–æ—é —ñ–Ω—Å–æ–ª—è—Ü—ñ—î—é (${optimalPowerData.month}, ${optimalPowerData.minInsolation} –∫–í—Ç¬∑–≥–æ–¥/–º¬≤/–¥–µ–Ω—å)`;
                powerInfoElement.style.display = 'block';
            }
        }
        
        // --- –û–ë–†–û–ë–ù–ò–ö –î–õ–Ø –ê–í–¢–û–ü–Ü–î–ë–û–†–£ –ü–û–¢–£–ñ–ù–û–°–¢–Ü ---
        autoPowerCheckboxElement.addEventListener('change', function() {
            if (this.checked) {
                // –°—Ç–≤–æ—Ä—é—î–º–æ –µ–ª–µ–º–µ–Ω—Ç –¥–ª—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫, —è–∫—â–æ –≤—ñ–Ω —â–µ –Ω–µ —ñ—Å–Ω—É—î
                if (!document.getElementById('powerAutoInfo')) {
                    const infoElement = document.createElement('div');
                    infoElement.id = 'powerAutoInfo';
                    infoElement.className = 'auto-power-info';
                    infoElement.style.display = 'none';
                    powerInputElement.parentNode.appendChild(infoElement);
                }
                
                // –í–∏–º–∏–∫–∞—î–º–æ –ø–æ–ª–µ –≤–≤–µ–¥–µ–Ω–Ω—è –ø–æ—Ç—É–∂–Ω–æ—Å—Ç—ñ
                powerInputElement.disabled = true;
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å
                updatePowerWithAutoCalculation();
            } else {
                // –í–º–∏–∫–∞—î–º–æ –ø–æ–ª–µ –≤–≤–µ–¥–µ–Ω–Ω—è –ø–æ—Ç—É–∂–Ω–æ—Å—Ç—ñ
                powerInputElement.disabled = false;
                
                // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫
                const powerInfoElement = document.getElementById('powerAutoInfo');
                if (powerInfoElement) {
                    powerInfoElement.style.display = 'none';
                }
            }
        });
        
        // --- –û–ù–û–í–õ–ï–ù–ù–Ø –ü–û–¢–£–ñ–ù–û–°–¢–Ü –ü–†–ò –ó–ú–Ü–ù–Ü –ü–ê–†–ê–ú–ï–¢–†–Ü–í ---
        regionSelectElement.addEventListener('change', updatePowerWithAutoCalculation);
        consumptionInputElement.addEventListener('input', updatePowerWithAutoCalculation);
        
        // --- –û–ë–†–û–ë–ö–ê –§–û–†–ú–ò ---
        formElement.addEventListener('submit', function(event) {
            event.preventDefault();
            console.log("–û–±—Ä–æ–±–∫–∞ —Ñ–æ—Ä–º–∏...");
            
            try {
                // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ —Ñ–æ—Ä–º–∏
                const regionCode = regionSelectElement.value;
                const powerKW = parseFloat(powerInputElement.value.replace(',', '.'));
                const monthlyConsumption = parseFloat(consumptionInputElement.value.replace(',', '.')) || 0;
                
                // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –∑–Ω–∞—á–µ–Ω—å —Ä–æ–∑—à–∏—Ä–µ–Ω–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ (–∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∑–Ω–∞—á–µ–Ω—å –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º)
                const greenTariff = parseFloat(greenTariffInputElement.value.replace(',', '.')) || GREEN_TARIFF;
                const taxPercent = parseFloat(taxInputElement.value.replace(',', '.')) || PDV * 100;
                const taxRate = taxPercent / 100;
                const domesticPrice = parseFloat(domesticPriceInputElement.value.replace(',', '.')) || DOMESTIC_PRICE;
                
                console.log("–í—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ:", { 
                    regionCode, powerKW, monthlyConsumption,
                    greenTariff, taxRate, domesticPrice 
                });
                
                // –í–∞–ª—ñ–¥–∞—Ü—ñ—è –≤–≤–µ–¥–µ–Ω–∏—Ö –¥–∞–Ω–∏—Ö
                if (!regionCode || !(regionCode in INSOLATION_DATA)) {
                    displayResult("‚ùå –û–±–µ—Ä—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–∏–π —Ä–µ–≥—ñ–æ–Ω.");
                    return;
                }
                if (isNaN(powerKW) || powerKW <= 0) {
                    displayResult("‚ùå –ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –ø–∞–Ω–µ–ª–µ–π –º–∞—î –±—É—Ç–∏ –±—ñ–ª—å—à–µ 0.");
                    return;
                }
                if (monthlyConsumption < 0) {
                    displayResult("‚ùå –í–ª–∞—Å–Ω–µ —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è –º–∞—î –±—É—Ç–∏ –Ω–µ–≤—ñ–¥'—î–º–Ω–∏–º.");
                    return;
                }
                if (greenTariff <= 0) {
                    displayResult("‚ùå –ó–µ–ª–µ–Ω–∏–π —Ç–∞—Ä–∏—Ñ –º–∞—î –±—É—Ç–∏ –±—ñ–ª—å—à–µ 0.");
                    return;
                }
                if (taxRate < 0 || taxRate > 1) {
                    displayResult("‚ùå –ü–æ–¥–∞—Ç–æ–∫ –º–∞—î –±—É—Ç–∏ –≤ –º–µ–∂–∞—Ö –≤—ñ–¥ 0% –¥–æ 100%.");
                    return;
                }
                if (domesticPrice <= 0) {
                    displayResult("‚ùå –¶—ñ–Ω–∞ –¥–ª—è –¥–æ–º–æ–≥–æ—Å–ø–æ–¥–∞—Ä—Å—Ç–≤ –º–∞—î –±—É—Ç–∏ –±—ñ–ª—å—à–µ 0.");
                    return;
                }
                
                // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó
                const monthlyGeneration = calculateGeneration(regionCode, powerKW);
                const totalGeneration = monthlyGeneration.reduce((a, b) => a + b, 0);
                
                // –§–æ—Ä–º—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
                let resultHTML = `
<div class="result-header">
    <div class="result-title">üåç ${REGION_NAMES[regionCode] || regionCode} - ${powerKW} –∫–í—Ç</div>
    <div class="result-subtitle">üîã –†—ñ—á–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è: ${Math.round(totalGeneration).toLocaleString('uk-UA')} –∫–í—Ç¬∑–≥–æ–¥</div>
</div>`;

// –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –¥–ª—è –≤–ª–∞—Å–Ω–æ–≥–æ —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è
if (monthlyConsumption > 0) {
    const consumption = calculateConsumption(monthlyGeneration, monthlyConsumption);
    const annualConsumption = monthlyConsumption * 12;
    const coveragePercent = annualConsumption > 0 ? (consumption.usedForOwnTotal / annualConsumption) * 100 : 0;
    const savingsUAH = Math.round(consumption.usedForOwnTotal * domesticPrice);
    const remainingForSale = Math.max(0, totalGeneration - consumption.usedForOwnTotal);
    const remainingProfit = remainingForSale * greenTariff * (1 - taxRate);
    
    resultHTML += `
    <table class="result-table consumption-table">
        <caption>üè† –ê–Ω–∞–ª—ñ–∑ —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è</caption>
        <tr>
            <td>‚òÄÔ∏è –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ —Å–æ–Ω—è—á–Ω–æ—ó –µ–Ω–µ—Ä–≥—ñ—ó:</td>
            <td><b>${Math.round(consumption.usedForOwnTotal).toLocaleString('uk-UA')}</b> –∫–í—Ç¬∑–≥–æ–¥ (${coveragePercent.toFixed(1)}%)</td>
        </tr>
        <tr>
            <td>‚ö° –ï–Ω–µ—Ä–≥—ñ—ó –∑ –º–µ—Ä–µ–∂—ñ:</td>
            <td><b>${Math.round(consumption.gridTotal).toLocaleString('uk-UA')}</b> –∫–í—Ç¬∑–≥–æ–¥</td>
        </tr>
        <tr>
            <td>üí∞ –ï–∫–æ–Ω–æ–º—ñ—è:</td>
            <td><b>${Math.round(consumption.usedForOwnTotal).toLocaleString('uk-UA')}</b> –∫–í—Ç¬∑–≥–æ–¥ (‚âà ${savingsUAH.toLocaleString('uk-UA')} –≥—Ä–Ω)</td>
        </tr>
        <tr>
            <td>üü¢ –ù–∞–¥–ª–∏—à–æ–∫ –¥–ª—è –ø—Ä–æ–¥–∞–∂—É:</td>
            <td><b>${Math.round(remainingForSale).toLocaleString('uk-UA')}</b> –∫–í—Ç¬∑–≥–æ–¥</td>
        </tr>
        <tr>
            <td>üíµ –î–æ—Ö—ñ–¥ (–ø—ñ—Å–ª—è –ø–æ–¥–∞—Ç–∫—ñ–≤):</td>
            <td><b>${remainingProfit.toLocaleString('uk-UA', {minimumFractionDigits:2, maximumFractionDigits:2})} ‚Ç¨</b></td>
        </tr>
    </table>
    
    <table class="result-table monthly-table">
        <caption>üìÖ –ú—ñ—Å—è—á–Ω—ñ –ø–æ–∫–∞–∑–Ω–∏–∫–∏</caption>
        <tr class="table-header">
            <th>–ú—ñ—Å—è—Ü—å</th>
            <th>–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è</th>
            <th>–í–ª–∞—Å–Ω–µ</th>
            <th>–ó –º–µ—Ä–µ–∂—ñ</th>
            <th>–ù–∞ –ø—Ä–æ–¥–∞–∂</th>
        </tr>`;
        
    for (let i = 0; i < 12; ++i) {
        resultHTML += `
        <tr>
            <td>${MONTHS_UA[i].slice(0,3)}</td>
            <td>‚òÄÔ∏è ${Math.round(monthlyGeneration[i])}</td>
            <td>üè† ${Math.round(consumption.ownMonthly[i])}</td>
            <td>‚ö° ${Math.round(consumption.gridMonthly[i])}</td>
            <td>üü¢ ${Math.round(consumption.remainingMonthly[i])}</td>
        </tr>`;
    }
    
    resultHTML += `</table>`;
} else {
    const profitAfterTax = totalGeneration * greenTariff * (1 - taxRate);
    resultHTML += `
    <div class="result-profit">
        <div>üíµ –î–æ—Ö—ñ–¥ (–ø—ñ—Å–ª—è –ø–æ–¥–∞—Ç–∫—ñ–≤): <b>${profitAfterTax.toLocaleString('uk-UA', {minimumFractionDigits:2, maximumFractionDigits:2})} ‚Ç¨</b></div>
    </div>
    
    <table class="result-table monthly-table">
        <caption>üìÖ –ú—ñ—Å—è—á–Ω—ñ –ø–æ–∫–∞–∑–Ω–∏–∫–∏</caption>
        <tr class="table-header">
            <th>–ú—ñ—Å—è—Ü—å</th>
            <th>–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è</th>
        </tr>`;
        
    for (let i = 0; i < 12; ++i) {
        resultHTML += `
        <tr>
            <td>${MONTHS_UA[i].slice(0,3)}</td>
            <td>‚òÄÔ∏è ${Math.round(monthlyGeneration[i])}</td>
        </tr>`;
    }
    
    resultHTML += `</table>`;
}

// –î–æ–¥–∞—î–º–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ –µ–∫–æ–Ω–æ–º—ñ—á–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
resultHTML += `
<div class="result-params">
    <small><b>–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏:</b> 
    –ó–µ–ª–µ–Ω–∏–π —Ç–∞—Ä–∏—Ñ: ${greenTariff.toFixed(2)} ‚Ç¨/–∫–í—Ç¬∑–≥–æ–¥, 
    –ü–æ–¥–∞—Ç–æ–∫: ${taxPercent}%, 
    –¢–∞—Ä–∏—Ñ –¥–ª—è –¥–æ–º–æ–≥–æ—Å–ø–æ–¥–∞—Ä—Å—Ç–≤: ${domesticPrice.toFixed(2)} –≥—Ä–Ω/–∫–í—Ç¬∑–≥–æ–¥</small>
</div>`;

displayResult(resultHTML);
                
            } catch (error) {
                console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ–±—Ä–æ–±—Ü—ñ —Ñ–æ—Ä–º–∏:", error);
                displayResult("‚ùå –ü–æ–º–∏–ª–∫–∞ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É: " + error.message);
            }
        });
        
        console.log("–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ");
    });
    </script>
</body>
</html>
